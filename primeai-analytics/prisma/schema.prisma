generator client {
  provider      = "prisma-client-js"
  engineType    = "binary" // <-- forces Windows-compatible engine
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
}

// ENUMS
enum DepartmentType {
  executive
  technology
  operations
  marketing
  client
}

enum RoleType {
  ceo
  coo
  cto
}

// MODELS
model Department {
  id    Int            @id @default(autoincrement())
  name  DepartmentType @unique
  roles Role[]
}

model Role {
  id           Int        @id @default(autoincrement())
  title        RoleType
  department   Department @relation(fields: [departmentId], references: [id])
  departmentId Int

  reportsTo   Role? @relation("RoleReportsTo", fields: [reportsToId], references: [id])
  reportsToId Int?

  subRoles Role[] @relation("RoleReportsTo")
}

model DigitalCustomerAssessment {
  id                   String                        @id @default(uuid())
  assessedAt           DateTime                      @default(now())
  overallNotes         String?
  createdAt            DateTime                      @default(now())
  updatedAt            DateTime                      @updatedAt
  acquisitionChannels  AcquisitionChannelProfile[]
  retentionAssesssment CustomerRetentionAssessment[]
}

model AcquisitionChannelProfile {
  id                        String                    @id @default(uuid())
  assessmentId              String
  channelTypes              String[]
  channelCount              Int?
  diversityNotes            String?
  digitalToTraditionalRatio Float?
  effectivenessMeasure      String?
  averageConversionRate     Float?
  journeyIntegrationLevel   String?
  trackingTools             String[]
  hasTrackingSystem         Boolean                   @default(false)
  trackingNotes             String?
  knowsTopPerformingChannel Boolean                   @default(false)
  contentMarketFitQuality   String?
  paidPercentage            Float?
  organicPercentage         Float?
  experimentsRunRecently    Boolean                   @default(false)
  hasReferralProgram        Boolean                   @default(false)
  partnershipExamples       String?
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime                  @updatedAt
  assessment                DigitalCustomerAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
}

model CustomerRetentionAssessment {
  id                        String                    @id @default(uuid())
  assessmentId              String
  strategyPlanningScore     Int
  strategyPlanningNotes     String?
  retentionTrackingScore    Int
  retentionTrackingNotes    String?
  relationshipSystemsScore  Int
  relationshipSystemsNotes  String?
  loyaltyRecognitionScore   Int
  loyaltyRecognitionNotes   String?
  experienceMonitoringScore Int
  experienceMonitoringNotes String?
  trustRecoveryScore        Int
  trustRecoveryNotes        String?
  customerDataUsageScore    Int
  customerDataUsageNotes    String?
  valueTrackingScore        Int
  valueTrackingNotes        String?
  postSaleEngagementScore   Int
  postSaleEngagementNotes   String?
  outreachFrequencyScore    Int
  outreachFrequencyNotes    String?
  retentionAdaptationScore  Int
  retentionAdaptationNotes  String?
  brandCommunityScore       Int
  brandCommunityNotes       String?
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime                  @updatedAt
  assessment                DigitalCustomerAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
}

model Sme {
  id             Int       @id @default(autoincrement())
  name           String
  phone          String
  email          String    @unique
  agreed_terms   Boolean
  otp_code       String?
  otp_expires_at DateTime?
  is_verified    Boolean   @default(false)

  profiles SmeProfile[] @relation("SmeToProfiles")
}

model SmeProfile {
  id                          Int      @id @default(autoincrement())
  smes_id                     Int
  business_name               String
  registration_number         String?  @unique
  owner_name                  String
  owner_gender                String?
  owner_age_group             String?
  contact_number              String
  email                       String?
  location                    String?
  industry                    String?
  sub_industry                String?
  nature_of_business          String?
  customer_types              String?
  business_size               String?
  number_of_employees         Int?
  estimated_monthly_revenue   Int?
  estimated_monthly_expenses  Int?
  premises_type               String?
  digital_customer_eligible   Boolean? @default(false)
  digital_operations_eligible Boolean? @default(false)
  digital_workspace_eligible  Boolean? @default(false)

  sme Sme @relation("SmeToProfiles", fields: [smes_id], references: [id], onDelete: Cascade)
}

model ProjectEstimate {
  id                 String   @id @default(cuid())
  fullName           String
  email              String
  companyName        String
  phoneNumber        String
  heardFrom          String?
  projectDescription String
  consent            Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Subscriber {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  subscribedAt DateTime @default(now())

  @@map("subscribers")
}

model DigitalOperationsAssessment {
  id         String   @id @default(uuid())
  assessedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  businessContext      BusinessContext?
  dataRecording        DataRecording?
  businessIntelligence BusinessIntelligence?
  dataSafety           DataSafety?
}

model BusinessContext {
  id           String @id @default(uuid())
  assessmentId String @unique

  devices     String[]
  deviceCount Int?

  internetType        String
  internetSpeedMbps   Float?
  internetReliability String?

  automationTools    String[]
  automatedProcesses Int?

  integratedSystems String[]

  productAnalysisMethods String[]
  dashboardsAvailable    Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assessment DigitalOperationsAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
}

model DataRecording {
  id Int @id @default(autoincrement())

  salesRecording     String
  expensesRecording  String
  inventoryRecording String
  recordBackup       String
  updateFrequency    String
  profitReview       String

  dataAccuracy     String
  dataCompleteness String
  dataConsistency  String

  recordingTools  String[]
  automationLevel String

  centralizedStorage Boolean
  accessibility      String
  sharedAcrossTeams  Boolean

  reportsGenerated String[]
  decisionSupport  String

  complianceStandards String[]
  dataRetentionPolicy String

  assessmentId String                      @unique
  assessment   DigitalOperationsAssessment @relation(fields: [assessmentId], references: [id])
}

model BusinessIntelligence {
  id Int @id @default(autoincrement())

  biTools          String[]
  integrationLevel String
  dataSources      String[]

  historicalDataAvailability String
  forecastModelsUsed         String[]
  forecastAccuracy           String
  forecastFrequency          String

  dashboardUsage    String
  reportsGenerated  String[]
  reportFrequency   String
  dataVisualization String
  insightQuality    String

  decisionBasedOnBI  String
  departmentsUsingBI String[]
  decisionSpeed      String
  biAutomationLevel  String

  dataGovernanceLevel String
  biSkills            String[]
  staffBITraining     Boolean
  biChallenges        String[]

  digitalOpsId String                      @unique
  digitalOps   DigitalOperationsAssessment @relation(fields: [digitalOpsId], references: [id])
}

model DataSafety {
  id Int @id @default(autoincrement())

  dataStorage         String
  dataClassification  String
  dataRetentionPolicy String

  recoveryPlan    String
  backupFrequency String
  recoveryTesting Boolean

  dataAccessControl    String
  authenticationMethod String
  devicePolicy         String

  encryption       String
  endpointSecurity String

  staffTrainingSafety String
  staffSecurityPolicy Boolean

  regularAudits        String
  incidentReporting    String
  lastSecurityIncident DateTime?

  complianceStandards String
  dataSharingPolicy   String

  digitalOpsId String                      @unique
  digitalOps   DigitalOperationsAssessment @relation(fields: [digitalOpsId], references: [id])
}
